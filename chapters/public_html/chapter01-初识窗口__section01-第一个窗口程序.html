<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>1.1 第一个windows窗口程序</title>
<!-- 2016-06-16 周四 23:04 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="keinvo" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="http://www.i3s.unice.fr/~malapert/css/worg.min.css"/>
<script type="text/javascript" src="http://www.i3s.unice.fr/~malapert/js/ga.min.js"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">1.1 第一个windows窗口程序</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1.1.1 Hello Windows</a></li>
<li><a href="#sec-2">1.1.2 窗口程序的基本结构</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">1.1.1 Hello Windows</h2>
<div class="outline-text-2" id="text-1">
<p>
就像学习编程时第一个程序总是打印“Hello World !”一样，下面是一个windows版的“Hello Windows !”，这个是windows编程的最小框架，后面我们将在这个框架的基础上一步步实现我们的界面引擎。
</p>
<div class="org-src-container">

<pre class="src src-C++">#include "stdafx.h" // Includes windows.h and tchar.h
LRESULT CALLBACK WndProc(HWND, UINT, WPARAM, LPARAM);

int APIENTRY _tWinMain(HINSTANCE hinst,
                    HINSTANCE /*hinstPrev*/,
                    LPTSTR pszCmdLine,
                    int nCmdShow) {
    LPCTSTR     pszMainWndClass = __T("HelloWinApp");
    WNDCLASSEX  wc = { sizeof(WNDCLASSEX) };
    wc.style = CS_HREDRAW | CS_VREDRAW;
    wc.hInstance = hinst;
    wc.hIcon = LoadIcon(0, IDI_APPLICATION);
    wc.hCursor = LoadCursor(0, IDC_ARROW);
    wc.hbrBackground = (HBRUSH)(COLOR_WINDOW+1);
    wc.lpszClassName = pszMainWndClass;
    wc.lpfnWndProc = WndProc;
    if( !::RegisterClassEx(&amp;wc) ) return -1;

    HWND hwnd = ::CreateWindowEx(WS_EX_CLIENTEDGE,
                            pszMainWndClass,
                            __T("Windows Application"),
                            WS_OVERLAPPEDWINDOW,
                            CW_USEDEFAULT, 0,
                            CW_USEDEFAULT, 0,
                            0, 0, hinst, 0);
    if( !hwnd ) return -1;

    ::ShowWindow(hwnd, nCmdShow);
    ::UpdateWindow(hwnd);

    MSG msg;
    while(::GetMessage(&amp;msg, 0, 0, 0)) {
        ::TranslateMessage(&amp;msg);
        ::DispatchMessage(&amp;msg);
    }

    return msg.wParam;
}

LRESULT CALLBACK WndProc(HWND hwnd, UINT nMsg, WPARAM wparam,LPARAM lparam) {
    switch( nMsg ) {
    case WM_PAINT: {
        PAINTSTRUCT ps;
        HDC hdc = ::BeginPaint(hwnd, &amp;ps);
        RECT rect; ::GetClientRect(hwnd, &amp;rect);
        ::DrawText(hdc, __T("Hello Windows !"), -1, &amp;rect, 
            DT_CENTER | DT_VCENTER | DT_SINGLELINE);
        ::EndPaint(hwnd, &amp;ps);
    }
    break;

    case WM_DESTROY:
        ::PostQuitMessage(0);
        break;

    default:
        return ::DefWindowProc(hwnd, nMsg, wparam, lparam);
        break;
    }

    return 0;
}
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">1.1.2 窗口程序的基本结构</h2>
<div class="outline-text-2" id="text-2">
<p>
一个典型的windows窗口程序有如下结构：
</p>
<ul class="org-ul">
<li>程序入口_tWinMain。
</li>
<li>调用RegisterClassEx注册窗口类。
</li>
<li>调用CreateWindow创建窗口，窗口创建完成后ShowWindow及UpdateWindow。
</li>
<li>循环调用GetMessage从窗口消息队列取消息，经过TranslateMessage转义后调用DispatchMessage派发给窗口消息处理过程。
</li>
<li>在窗口过程WndProc里处理感兴趣的消息。比如上面代码里我们处理WM_PAINT消息，并在窗口正中间显示“Hello Windows !”。
</li>
</ul>

<div class="center">

<div class="figure">
<p><img src="./img/01-HelloWin.png" alt="01-HelloWin.png" />
</p>
</div>
</div>
<div class="center">
<p>
<i>1-1-1第一个windows窗口程序</i>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: keinvo</p>
<p class="date">Created: 2016-06-16 周四 23:04</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
